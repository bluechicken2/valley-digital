<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>TradingAI - AI-Powered Crypto Intelligence</title>
    <!-- Midnight Galaxy Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Space+Grotesk:wght@400;500;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">


    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600;700;800&family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet">

    <style>
        /* ============================================
           CSS VARIABLES & THEME
           ============================================ */
        :root {
            /* MIDNIGHT GALAXY THEME */
            --galaxy-void: #05080f;
            --galaxy-deep: #0a0e1a;
            --galaxy-nebula: #111827;
            --galaxy-dust: #1a2235;
            --galaxy-cloud: #242d42;
            --nebula-purple: #a855f7;
            --nebula-pink: #ec4899;
            --stellar-blue: #3b82f6;
            --stellar-cyan: #06b6d4;
            --aurora-green: #10b981;
            --aurora-gold: #f59e0b;

            --dark-950: #07080a;
            --dark-900: #0d1117;
            --dark-800: #161b22;
            --dark-700: #21262d;
            --dark-600: #30363d;
            --dark-500: #484f58;
            --brand-purple: #a371f7;
            --brand-blue: #58a6ff;
            --brand-green: #3fb950;
            --brand-red: #f85149;
            --brand-yellow: #fbbf24;

            /* Typography */
            --font-display: 'Outfit', sans-serif;
            --font-body: 'Space Grotesk', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;

            /* Spacing */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;

            /* Touch targets */
            --touch-min: 44px;

            /* Transitions */
            --transition-fast: 0.15s ease;
            --transition-normal: 0.25s ease;
            --transition-slow: 0.4s ease;
        }

        /* ============================================
           RESET & BASE
           ============================================ */
        * { box-sizing: border-box; margin: 0; padding: 0; }

        html {
            scroll-behavior: smooth;
            -webkit-text-size-adjust: 100%;
        }

        body {
            font-family: var(--font-body);
            background: var(--dark-900);
            color: #e6edf3;
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* ============================================
           STARFIELD BACKGROUND
           ============================================ */
        .starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle var(--duration, 3s) ease-in-out infinite;
            opacity: 0;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0; transform: scale(0.5); }
            50% { opacity: var(--max-opacity, 0.8); transform: scale(1); }
        }

        /* ============================================
           GLASS MORPHISM
           ============================================ */
        .glass {
            background: rgba(22, 27, 34, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(48, 54, 61, 0.5);
        }

        .glass-light {
            background: rgba(33, 38, 45, 0.6);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        /* ============================================
           TYPOGRAPHY
           ============================================ */
        h1, h2, h3, h4 {
            font-family: var(--font-display);
            font-weight: 700;
            line-height: 1.2;
        }

        .gradient-text {
            background: linear-gradient(135deg, var(--brand-purple), var(--brand-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .mono {
            font-family: var(--font-mono);
        }

        /* ============================================
           ANIMATIONS
           ============================================ */
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        @keyframes scaleIn {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }

        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        .animate-fade-in-up { animation: fadeInUp 0.5s ease-out forwards; }
        .animate-scale-in { animation: scaleIn 0.3s ease-out forwards; }

        .skeleton {
            background: linear-gradient(90deg, var(--dark-700) 25%, var(--dark-600) 50%, var(--dark-700) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 4px;
        }

        .pulse-live { animation: pulse 2s infinite; }

        .typing-indicator span {
            animation: typing 1.4s infinite ease-in-out;
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--brand-purple);
            border-radius: 50%;
            margin: 0 2px;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        /* ============================================
           LAYOUT
           ============================================ */
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 var(--space-md);
            position: relative;
            z-index: 1;
        }

        main.container {
            padding-bottom: var(--space-2xl);
        }

        /* ============================================
           HEADER - MOBILE FIRST
           ============================================ */
        header {
            border-bottom: 1px solid var(--dark-600);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-inner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-md) 0;
            gap: var(--space-md);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            flex-shrink: 0;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--brand-purple), var(--brand-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .logo-text {
            display: none;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .live-badge {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 17px;
            color: #a8b2c1;
            padding: var(--space-sm) var(--space-md);
            background: var(--dark-800);
            border-radius: 20px;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--brand-green);
            flex-shrink: 0;
        }

        .live-dot.offline {
            background: var(--brand-red);
        }

        .live-dot.degraded {
            background: var(--brand-yellow);
        }

        /* Mobile menu button */
        .menu-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: var(--touch-min);
            height: var(--touch-min);
            background: transparent;
            border: 1px solid var(--dark-600);
            border-radius: 8px;
            color: #e6edf3;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .menu-btn:hover {
            background: var(--dark-700);
        }

        .menu-btn:active {
            transform: scale(0.95);
        }

        /* Desktop nav */
        .desktop-nav {
            display: none;
        }

        .btn-primary {
            padding: var(--space-sm) var(--space-md);
            background: linear-gradient(135deg, var(--brand-purple), var(--brand-blue));
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            font-family: var(--font-body);
            cursor: pointer;
            text-decoration: none;
            font-size: 16px;
            white-space: nowrap;
            min-height: var(--touch-min);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(163, 113, 247, 0.3);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        /* ============================================
           MOBILE MENU
           ============================================ */
        .mobile-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 200;
            display: none;
        }

        .mobile-menu.open {
            display: block;
        }

        .mobile-menu-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            animation: fadeIn 0.2s ease-out;
        }

        .mobile-menu-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 280px;
            height: 100%;
            background: var(--dark-800);
            border-right: 1px solid var(--dark-600);
            padding: var(--space-lg);
            animation: slideIn 0.3s ease-out;
        }

        .mobile-menu-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-xl);
        }

        .mobile-menu-close {
            width: var(--touch-min);
            height: var(--touch-min);
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: #a8b2c1;
            cursor: pointer;
            border-radius: 8px;
        }

        .mobile-menu-close:hover {
            background: var(--dark-700);
            color: white;
        }

        .mobile-menu-nav {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .mobile-menu-link {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            color: #e6edf3;
            text-decoration: none;
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition-fast);
        }

        .mobile-menu-link:hover {
            background: var(--dark-700);
        }

        .mobile-menu-link svg {
            flex-shrink: 0;
        }

        /* ============================================
           HERO SECTION
           ============================================ */
        .hero {
            text-align: center;
            padding: var(--space-xl) 0;
        }

        .hero h1 {
            font-size: clamp(28px, 7vw, 48px);
            margin-bottom: var(--space-md);
        }

        .hero p {
            color: #a8b2c1;
            font-size: clamp(15px, 3vw, 18px);
            max-width: 600px;
            margin: 0 auto;
        }

        /* ============================================
           CONNECTION STATUS BANNER
           ============================================ */
        .connection-banner {
            padding: var(--space-md);
            border-radius: 12px;
            margin-bottom: var(--space-lg);
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .connection-banner.offline {
            display: block;
            background: rgba(248, 81, 73, 0.15);
            border: 1px solid rgba(248, 81, 73, 0.4);
        }

        .connection-banner.degraded {
            display: block;
            background: rgba(251, 191, 36, 0.15);
            border: 1px solid rgba(251, 191, 36, 0.4);
        }

        .connection-banner.online {
            display: none;
        }

        .banner-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-md);
            flex-wrap: wrap;
        }

        .banner-message {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 16px;
        }

        .retry-btn {
            padding: var(--space-sm) var(--space-md);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: white;
            font-family: var(--font-body);
            font-size: 17px;
            cursor: pointer;
            min-height: 36px;
            transition: var(--transition-fast);
        }

        .retry-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* ============================================
           PRICE CARDS - RESPONSIVE GRID
           ============================================ */
        .price-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }

        .price-card {
            background: var(--dark-800);
            border-radius: 16px;
            padding: var(--space-lg);
            border: 1px solid var(--dark-600);
            transition: var(--transition-normal);
            animation: fadeInUp 0.5s ease-out forwards;
            opacity: 0;
        }

        .price-card:nth-child(2) {
            animation-delay: 0.1s;
        }

        .price-card:hover {
            border-color: rgba(163, 113, 247, 0.5);
            transform: translateY(-2px);
        }

        .price-card.eth:hover {
            border-color: rgba(88, 166, 255, 0.5);
        }

        .price-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-md);
            flex-wrap: wrap;
            gap: var(--space-sm);
        }

        .coin-info {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .coin-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-family: var(--font-display);
            flex-shrink: 0;
        }

        .btc-icon { background: rgba(249, 115, 22, 0.2); }
        .eth-icon { background: rgba(59, 130, 246, 0.2); }

        .coin-name {
            font-weight: 600;
            font-size: 16px;
        }

        .coin-symbol {
            font-size: 17px;
            color: #a8b2c1;
        }

        .change-badge {
            padding: 6px 14px;
            border-radius: 999px;
            font-size: 16px;
            font-weight: 600;
            font-family: var(--font-mono);
        }

        .change-positive {
            background: rgba(63, 185, 80, 0.2);
            color: var(--brand-green);
        }

        .change-negative {
            background: rgba(248, 81, 73, 0.2);
            color: var(--brand-red);
        }

        .price-value {
            font-size: clamp(28px, 8vw, 40px);
            font-weight: 700;
            font-family: var(--font-display);
            margin-bottom: var(--space-xs);
        }

        .price-label {
            color: #a8b2c1;
            font-size: 16px;
            margin-bottom: var(--space-md);
        }

        .sparkline-container {
            height: 64px;
            background: var(--dark-700);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .sparkline-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .sparkline-error {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #a8b2c1;
            font-size: 17px;
        }

        /* ============================================
           CHART SECTION
           ============================================ */
        .chart-section {
            margin-bottom: var(--space-xl);
            animation: fadeInUp 0.5s ease-out 0.2s forwards;
            opacity: 0;
        }

        .chart-container {
            background: var(--dark-800);
            border-radius: 16px;
            border: 1px solid var(--dark-600);
            padding: var(--space-lg);
        }

        .chart-header {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
        }

        .chart-controls {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
        }

        .timeframe-btn {
            padding: var(--space-sm) var(--space-md);
            background: var(--dark-700);
            border: 1px solid var(--dark-600);
            border-radius: 8px;
            color: #a8b2c1;
            font-family: var(--font-mono);
            font-size: 17px;
            cursor: pointer;
            min-height: 36px;
            transition: var(--transition-fast);
        }

        .timeframe-btn:hover {
            background: var(--dark-600);
            color: white;
        }

        .timeframe-btn.active {
            background: linear-gradient(135deg, var(--brand-purple), var(--brand-blue));
            border-color: transparent;
            color: white;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        .chart-canvas {
            width: 100%;
            height: 100%;
        }

        .chart-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #a8b2c1;
            font-size: 16px;
        }

        /* ============================================
           CHAT SECTION - MOBILE OPTIMIZED
           ============================================ */
        .chat-section {
            background: var(--dark-800);
            border-radius: 16px;
            border: 1px solid var(--dark-600);
            margin-bottom: var(--space-xl);
            overflow: hidden;
            animation: fadeInUp 0.5s ease-out 0.3s forwards;
            opacity: 0;
        }

        .chat-header {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-lg);
            border-bottom: 1px solid var(--dark-600);
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--brand-purple), var(--brand-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .chat-title {
            font-weight: 600;
            font-size: 16px;
        }

        .chat-subtitle {
            font-size: 16px;
            color: #a8b2c1;
        }

        .chat-messages {
            height: 350px;
            overflow-y: auto;
            padding: var(--space-lg);
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            -webkit-overflow-scrolling: touch;
        }

        .message {
            display: flex;
            gap: var(--space-sm);
            max-width: 90%;
            animation: fadeIn 0.3s ease-out;
        }

        .message.user {
            margin-left: auto;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: linear-gradient(135deg, var(--brand-purple), var(--brand-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .message-bubble {
            background: var(--dark-700);
            padding: var(--space-md);
            border-radius: 12px;
            font-size: 17px;
            line-height: 1.5;
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, rgba(163, 113, 247, 0.3), rgba(88, 166, 255, 0.3));
        }

        .chat-input-area {
            padding: var(--space-lg);
            border-top: 1px solid var(--dark-600);
        }

        .chat-form {
            display: flex;
            gap: var(--space-sm);
        }

        .chat-input {
            flex: 1;
            padding: var(--space-md);
            background: var(--dark-700);
            border: 1px solid var(--dark-600);
            border-radius: 12px;
            color: white;
            font-family: var(--font-body);
            font-size: 16px; /* Prevents zoom on iOS */
            min-height: var(--touch-min);
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--brand-purple);
        }

        .chat-input::placeholder {
            color: #a8b2c1;
        }

        .chat-submit {
            padding: var(--space-md) var(--space-lg);
            background: linear-gradient(135deg, var(--brand-purple), var(--brand-blue));
            border: none;
            border-radius: 12px;
            color: white;
            font-family: var(--font-body);
            font-weight: 600;
            cursor: pointer;
            min-width: var(--touch-min);
            min-height: var(--touch-min);
            transition: var(--transition-fast);
        }

        .chat-submit:hover:not(:disabled) {
            transform: translateY(-1px);
        }

        .chat-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* ============================================
           NEWS SECTION
           ============================================ */
        .news-section {
            margin-bottom: var(--space-xl);
            animation: fadeInUp 0.5s ease-out 0.4s forwards;
            opacity: 0;
        }

        .news-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-lg);
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        .news-header h2 {
            font-size: 20px;
        }

        .refresh-btn {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            background: var(--dark-800);
            border: 1px solid var(--dark-600);
            border-radius: 8px;
            color: #a8b2c1;
            font-family: var(--font-body);
            font-size: 16px;
            cursor: pointer;
            min-height: 36px;
            transition: var(--transition-fast);
        }

        .refresh-btn:hover {
            background: var(--dark-700);
            color: white;
        }

        .news-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-md);
        }

        .news-card {
            background: var(--dark-800);
            border-radius: 12px;
            padding: var(--space-lg);
            border: 1px solid var(--dark-600);
            text-decoration: none;
            color: inherit;
            transition: var(--transition-normal);
        }

        .news-card:hover {
            border-color: rgba(163, 113, 247, 0.5);
            transform: translateY(-2px);
        }

        .news-card h4 {
            font-size: 17px;
            margin-bottom: var(--space-sm);
            line-height: 1.4;
        }

        .news-meta {
            font-size: 17px;
            color: #a8b2c1;
        }

        /* ============================================
           FEATURES GRID
           ============================================ */
        .features-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
            animation: fadeInUp 0.5s ease-out 0.5s forwards;
            opacity: 0;
        }

        .feature-card {
            background: var(--dark-800);
            border-radius: 12px;
            padding: var(--space-lg);
            border: 1px solid var(--dark-600);
            text-align: center;
            transition: var(--transition-normal);
        }

        .feature-card:hover {
            border-color: rgba(163, 113, 247, 0.3);
        }

        .feature-icon {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--space-md);
        }

        .feature-card h4 {
            font-size: 16px;
            margin-bottom: var(--space-sm);
        }

        .feature-card p {
            font-size: 16px;
            color: #a8b2c1;
        }

        /* ============================================
           FOOTER
           ============================================ */
        footer {
            border-top: 1px solid var(--dark-600);
            background: var(--dark-950);
            padding: var(--space-xl) 0;
        }

        .footer-inner {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-lg);
            text-align: center;
        }

        .footer-logo {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .footer-logo-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: linear-gradient(135deg, var(--brand-purple), var(--brand-blue));
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .footer-links {
            display: flex;
            gap: var(--space-lg);
            flex-wrap: wrap;
            justify-content: center;
        }

        .footer-links a {
            color: #a8b2c1;
            text-decoration: none;
            font-size: 16px;
            padding: var(--space-sm);
            min-height: var(--touch-min);
            display: flex;
            align-items: center;
        }

        .footer-links a:hover {
            color: white;
        }

        .footer-copy {
            color: #a8b2c1;
            font-size: 17px;
        }

        /* ============================================
           RESPONSIVE BREAKPOINTS
           ============================================ */

        /* Small phones */
        @media (max-width: 374px) {
            .hero h1 { font-size: 24px; }
            .price-value { font-size: 24px; }
            .chat-messages { height: 280px; }
            .change-badge { padding: 4px 10px; font-size: 16px; }
        }

        /* Larger phones */
        @media (min-width: 375px) {
            .price-grid { gap: var(--space-lg); }
        }

        /* Tablets */
        @media (min-width: 640px) {
            .logo-text { display: block; }
            .menu-btn { display: none; }
            .desktop-nav { display: flex; align-items: center; gap: var(--space-md); }
            .price-grid { grid-template-columns: 1fr 1fr; }
            .news-grid { grid-template-columns: repeat(2, 1fr); }
            .features-grid { grid-template-columns: repeat(3, 1fr); }
            .chart-wrapper { height: 350px; }
            .chat-messages { height: 400px; }
        }

        /* Desktop */
        @media (min-width: 768px) {
            .hero { padding: var(--space-2xl) 0; }
            .chart-header { flex-direction: row; justify-content: space-between; align-items: center; }
            .chat-messages { height: 450px; }
            .message { max-width: 70%; }
        }

        /* Large desktop */
        @media (min-width: 1024px) {
            .container { padding: 0 var(--space-xl); }
            .news-grid { grid-template-columns: repeat(3, 1fr); }
            .chart-wrapper { height: 400px; }
            .footer-inner { flex-direction: row; justify-content: space-between; }
        }

        /* ============================================
           UTILITY CLASSES
           ============================================ */
        .hidden { display: none !important; }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }

        /* Focus styles for accessibility */
        :focus-visible {
            outline: 2px solid var(--brand-purple);
            outline-offset: 2px;
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
 *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            .starfield { display: none; }
        }
    

        /* ============================================
           SENTIMENT DISPLAY
           ============================================ */
        .sentiment-gauge {
            width: 120px;
            height: 60px;
            margin: 0 auto 16px;
            position: relative;
            overflow: hidden;
        }

        .sentiment-gauge-bg {
            width: 120px;
            height: 60px;
            border-radius: 60px 60px 0 0;
            background: conic-gradient(from 180deg at 50% 100%, 
                var(--solar-red) 0deg, 
                var(--aurora-gold) 90deg, 
                var(--aurora-green) 180deg);
            position: absolute;
            top: 0; left: 0;
        }

        .sentiment-gauge-needle {
            width: 4px;
            height: 50px;
            background: var(--text-starlight);
            position: absolute;
            bottom: 0;
            left: 50%;
            transform-origin: bottom center;
            transform: translateX(-50%) rotate(0deg);
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 2px;
            z-index: 2;
        }

        .sentiment-gauge-center {
            width: 16px;
            height: 16px;
            background: var(--galaxy-nebula);
            border: 3px solid var(--text-starlight);
            border-radius: 50%;
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3;
        }

        .sentiment-overall {
            text-align: center;
            padding: 16px;
            background: rgba(26, 34, 53, 0.5);
            border-radius: 12px;
            margin-bottom: 16px;
            border: 1px solid var(--glass-border);
        }

        .sentiment-overall-value {
            font-family: var(--font-display);
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .sentiment-overall-value.bullish { color: var(--aurora-green); }
        .sentiment-overall-value.bearish { color: var(--solar-red); }
        .sentiment-overall-value.neutral { color: var(--aurora-gold); }

        .sentiment-overall-label {
            font-family: var(--font-mono);
            font-size: 1rem;
            color: var(--text-twilight);
        }

        .sentiment-themes {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
            justify-content: center;
        }

        .sentiment-theme-tag {
            padding: 4px 12px;
            background: rgba(168, 85, 247, 0.15);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 16px;
            font-family: var(--font-mono);
            font-size: 0.85rem;
            color: var(--nebula-purple);
        }

        .sentiment-last-update {
            text-align: center;
            font-family: var(--font-mono);
            font-size: 0.8rem;
            color: var(--text-shadow);
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--glass-border);
        }

    </style>
    <!-- Chart.js for live charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Starfield Background -->
    <div class="starfield" id="starfield"></div>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobile-menu">
        <div class="mobile-menu-overlay" onclick="closeMobileMenu()"></div>
        <div class="mobile-menu-content">
            <div class="mobile-menu-header">
                <div class="logo">
                    <div class="logo-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                            <path d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                        </svg>
                    </div>
                    <span class="gradient-text" style="font-weight: 700;">TradingAI</span>
                </div>
                <button class="mobile-menu-close" onclick="closeMobileMenu()" aria-label="Close menu">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <nav class="mobile-menu-nav">
                <a href="#prices" class="mobile-menu-link" onclick="closeMobileMenu()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Prices
                </a>
                <a href="#chart" class="mobile-menu-link" onclick="closeMobileMenu()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    Chart
                </a>
                <a href="#chat" class="mobile-menu-link" onclick="closeMobileMenu()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                    </svg>
                    AI Chat
                </a>
                <a href="#news" class="mobile-menu-link" onclick="closeMobileMenu()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/>
                    </svg>
                    News
                </a>
            </nav>
        </div>
    </div>

    <!-- Header -->
    <header class="glass">
        <div class="container header-inner">
            <div class="logo">
                <div class="logo-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <path d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                    </svg>
                </div>
                <div class="logo-text">
                    <div style="font-weight: 700; font-size: 18px;" class="gradient-text">TradingAI</div>
                    <div style="font-size: 16px; color: #a8b2c1;">AI-Powered Intelligence</div>
                </div>
            </div>

            <div class="header-actions">
                <div class="live-badge">
                    <span class="live-dot" id="live-indicator"></span>
                    <span id="live-text">Live</span>
                </div>
                <nav class="desktop-nav">
                    <a href="#prices" style="color: #a8b2c1; text-decoration: none; font-size: 16px;">Prices</a>
                    <a href="#chart" style="color: #a8b2c1; text-decoration: none; font-size: 16px;">Chart</a>
                    <a href="#chat" class="btn-primary">Ask AI</a>
                </nav>
                <button class="menu-btn" onclick="openMobileMenu()" aria-label="Open menu">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Hero -->
        <section class="hero">
            <h1><span class="gradient-text">Ask AI About Crypto</span></h1>
            <p>Get instant, intelligent answers about Bitcoin and Ethereum. Real-time data combined with AI analysis.</p>
        </section>

        <!-- Connection Status Banner -->
        <div class="connection-banner" id="connection-banner">
            <div class="banner-content">
                <div class="banner-message">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="banner-icon">
                        <path d="M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3"/>
                    </svg>
                    <span id="banner-message">Connection lost</span>
                </div>
                <button class="retry-btn" onclick="retryAll()" id="retry-btn">Retry</button>
            </div>
        </div>

        <!-- Price Cards -->
        <section class="price-grid" id="prices">
            <div class="price-card" id="btc-card">
                <div class="price-header">
                    <div class="coin-info">
                        <div class="coin-icon btc-icon">₿</div>
                        <div>
                            <div class="coin-name">Bitcoin</div>
                            <div class="coin-symbol">BTC</div>
                        </div>
                    </div>
                    <div class="change-badge skeleton" id="btc-change">&nbsp;&nbsp;&nbsp;&nbsp;</div>
                </div>
                <div class="price-value skeleton" id="btc-price" style="display: inline-block;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
                <div class="price-label">24h Change</div>
                <div class="sparkline-container" id="btc-sparkline-wrap">
                    <canvas id="btc-sparkline" class="sparkline-canvas"></canvas>
                </div>
            </div>
            <div class="price-card eth" id="eth-card">
                <div class="price-header">
                    <div class="coin-info">
                        <div class="coin-icon eth-icon">Ξ</div>
                        <div>
                            <div class="coin-name">Ethereum</div>
                            <div class="coin-symbol">ETH</div>
                        </div>
                    </div>
                    <div class="change-badge skeleton" id="eth-change">&nbsp;&nbsp;&nbsp;&nbsp;</div>
                </div>
                <div class="price-value skeleton" id="eth-price" style="display: inline-block;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
                <div class="price-label">24h Change</div>
                <div class="sparkline-container" id="eth-sparkline-wrap">
                    <canvas id="eth-sparkline" class="sparkline-canvas"></canvas>
                </div>
            </div>
        </section>

        <!-- Chart Section -->
        <section class="chart-section" id="chart">
            <div class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">BTC/USD Price Chart</h3>
                    <div class="chart-controls">
                        <button class="timeframe-btn" data-range="1H">1H</button>
                        <button class="timeframe-btn" data-range="4H">4H</button>
                        <button class="timeframe-btn active" data-range="1D">1D</button>
                        <button class="timeframe-btn" data-range="1W">1W</button>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="price-chart" class="chart-canvas"></canvas>
                    <div class="chart-loading" id="chart-loading">Loading chart...</div>
                </div>
            </div>
        </section>

        <!-- Chat Section -->
        <section class="chat-section" id="chat">
            <div class="chat-header">
                <div class="chat-avatar">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                    </svg>
                </div>
                <div>
                    <div class="chat-title">TradingAI Assistant</div>
                    <div class="chat-subtitle">Powered by real-time market data</div>
                </div>
            </div>
            <div class="chat-messages" id="chat-messages">
                <div class="message ai">
                    <div class="message-avatar">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                            <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                        </svg>
                    </div>
                    <div class="message-bubble">
                        Hello! I'm your AI trading assistant. Ask me anything about Bitcoin or Ethereum.<br><br>
                        <span style="color: #a8b2c1; font-size: 17px;">
                        • "What's happening with BTC?"<br>
                        • "Should I buy ETH?"<br>
                        • "Is Bitcoin overvalued?"
                        </span>
                    </div>
                </div>
            </div>
            <div class="chat-input-area">
                <form class="chat-form" id="chat-form">
                    <input type="text" id="chat-input" placeholder="Ask about BTC or ETH..." autocomplete="off">
                    <button type="submit" class="chat-submit" id="chat-btn">Send</button>
                </form>
            </div>
        </section>

        <!-- News Section -->
        <section class="news-section" id="news">
            <div class="news-header">
                <h2>Latest Crypto News</h2>
                <button class="refresh-btn" onclick="fetchNewsWithRetry()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                    Refresh
                </button>
            </div>
            <div class="news-grid" id="news-container">
                <div class="news-card"><div class="skeleton" style="height: 14px; width: 80%; margin-bottom: 8px;"></div><div class="skeleton" style="height: 12px; width: 50%;"></div></div>
                <div class="news-card"><div class="skeleton" style="height: 14px; width: 80%; margin-bottom: 8px;"></div><div class="skeleton" style="height: 12px; width: 50%;"></div></div>
                <div class="news-card"><div class="skeleton" style="height: 14px; width: 80%; margin-bottom: 8px;"></div><div class="skeleton" style="height: 12px; width: 50%;"></div></div>
            </div>
        </section>

        <!-- Features -->
        
        <!-- Sentiment Analysis Panel -->
        <section class="sentiment-section">
            <div class="sentiment-overall">
                    <div class="sentiment-gauge">
                        <div class="sentiment-gauge-bg"></div>
                        <div class="sentiment-gauge-needle" id="sentiment-needle"></div>
                        <div class="sentiment-gauge-center"></div>
                    </div>
                    <div class="sentiment-overall-value bullish" id="overall-sentiment-value">--</div>
                    <div class="sentiment-overall-label" id="overall-sentiment-label">Loading...</div>
                    <div class="sentiment-themes" id="sentiment-themes"></div>
                </div>

                <!-- Asset Sentiments (Dynamic) -->
                <div id="sentiment-assets">
                    <!-- Populated by JavaScript -->
                </div>

                <div class="sentiment-last-update">
                    Last updated: <span id="sentiment-timestamp">--</span>
                </div>
            </div>
        </div>
        </section>
<section class="features-grid">
            <div class="feature-card">
                <div class="feature-icon" style="background: rgba(63, 185, 80, 0.2);">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--brand-green)" stroke-width="2">
                        <path d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                </div>
                <h4>Real-Time Data</h4>
                <p>Live prices updated every 5 seconds.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon" style="background: rgba(163, 113, 247, 0.2);">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--brand-purple)" stroke-width="2">
                        <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                    </svg>
                </div>
                <h4>AI-Powered Analysis</h4>
                <p>Ask natural language questions.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon" style="background: rgba(88, 166, 255, 0.2);">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--brand-blue)" stroke-width="2">
                        <path d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
                <h4>Just $49/month</h4>
                <p>Bloomberg-quality insights.</p>
            </div>
        </section>
    </main>

    <footer>
        <div class="container footer-inner">
            <div class="footer-logo">
                <div class="footer-logo-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <path d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                    </svg>
                </div>
                <span style="font-weight: 600;" class="gradient-text">TradingAI</span>
            </div>
            <p class="footer-copy">© 2026 TradingAI. All rights reserved. Not financial advice.</p>
            <div class="footer-links">
                <a href="#">Terms</a>
                <a href="#">Privacy</a>
                <a href="#">Contact</a>
            </div>
        </div>
    </footer>

    <script>
        async function fetchSentiment() {
            try {
                const response = await fetch('data/sentiment.json?t=' + Date.now());
                if (!response.ok) throw new Error('Failed to fetch sentiment');

                const data = await response.json();
                updateSentimentDisplay(data);
            } catch (error) {
                console.error('Sentiment fetch error:', error);
            }
        }

        function updateSentimentDisplay(data) {
            // Update overall sentiment
            const overallValue = document.getElementById('overall-sentiment-value');
            const overallLabel = document.getElementById('overall-sentiment-label');
            const needle = document.getElementById('sentiment-needle');
            const themesEl = document.getElementById('sentiment-themes');
            const assetsEl = document.getElementById('sentiment-assets');
            const timestampEl = document.getElementById('sentiment-timestamp');

            // Overall sentiment value
            const sentiment = data.overall?.sentiment || 50;
            const label = data.overall?.label || 'Neutral';

            overallValue.textContent = sentiment + '%';
            overallValue.className = 'sentiment-overall-value';

            if (sentiment >= 60) {
                overallValue.classList.add('bullish');
                overallLabel.textContent = label + ' 📈';
            } else if (sentiment <= 40) {
                overallValue.classList.add('bearish');
                overallLabel.textContent = label + ' 📉';
            } else {
                overallValue.classList.add('neutral');
                overallLabel.textContent = label + ' ⏸️';
            }

            // Rotate needle (-90deg = 0, 0deg = 50, +90deg = 100)
            const needleRotation = (sentiment / 100) * 180 - 90;
            needle.style.transform = `translateX(-50%) rotate(${needleRotation}deg)`;

            // Update themes
            const themes = data.themes || [];
            themesEl.innerHTML = themes.map(t => 
                `<span class="sentiment-theme-tag">${t}</span>`
            ).join('');

            // Update assets
            const assets = data.assets || {};
            assetsEl.innerHTML = Object.entries(assets).map(([symbol, info]) => {
                const score = info.sentiment || 50;
                const trend = info.trend || 'neutral';
                const confidence = info.confidence || 0;
                const isBullish = trend === 'bullish' || score >= 50;

                return `
                    <div class="sentiment-item">
                        <div class="sentiment-left">
                            <span class="sentiment-asset">${symbol}</span>
                            <span class="sentiment-score ${isBullish ? 'bullish' : 'bearish'}">${score}% ${trend}</span>
                        </div>
                        <div class="sentiment-bar">
                            <div class="sentiment-bar-fill ${isBullish ? 'bullish' : 'bearish'}" style="width: ${score}%"></div>
                        </div>
                    </div>
                `;
            }).join('');

            // Update timestamp
            if (data.timestamp) {
                const date = new Date(data.timestamp);
                timestampEl.textContent = date.toLocaleTimeString();
            }
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            fetchSentiment();  // Load sentiment on page load
            setInterval(updatePrices, 5000);
            setInterval(updateCharts, 3000);
            setInterval(fetchSentiment, 5 * 60 * 1000);

    // ============================================
    // STATE & CONFIGURATION
    // ============================================
    const state = {
        btcPrice: 0,
        ethPrice: 0,
        btcChange: 0,
        ethChange: 0,
        btcHistory: [],
        ethHistory: [],
        chartData: [],
        isOnline: navigator.onLine,
        connectionStatus: 'online' // online, degraded, offline
    };

    const config = {
        maxRetries: 3,
        baseTimeout: 8000,
        priceRefreshInterval: 5000,
        chartRefreshInterval: 60000,
        newsRefreshInterval: 300000,
        circuitBreakerThreshold: 5,
        circuitBreakerResetTime: 30000
    };

    // Circuit breaker state
    const circuitBreaker = {
        prices: { failures: 0, lastFailure: 0, isOpen: false },
        news: { failures: 0, lastFailure: 0, isOpen: false },
        sparkline: { failures: 0, lastFailure: 0, isOpen: false },
        chart: { failures: 0, lastFailure: 0, isOpen: false }
    };

    // ============================================
    // UTILITY FUNCTIONS
    // ============================================
    const formatPrice = p => new Intl.NumberFormat('en-US', { 
        style: 'currency', 
        currency: 'USD',
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    }).format(p);

    const formatChange = c => (c >= 0 ? '+' : '') + c.toFixed(2) + '%';
    const sleep = ms => new Promise(r => setTimeout(r, ms));
    const backoff = (retry, max = 5) => Math.min(1000 * Math.pow(2, retry), 10000) + Math.random() * 1000;

    // ============================================
    // CIRCUIT BREAKER
    // ============================================
    function isCircuitOpen(service) {
        const cb = circuitBreaker[service];
        if (!cb) return false;

        if (cb.isOpen) {
            const timeSinceFailure = Date.now() - cb.lastFailure;
            if (timeSinceFailure > config.circuitBreakerResetTime) {
                cb.isOpen = false;
                cb.failures = 0;
                return false;
            }
            return true;
        }
        return false;
    }

    function recordFailure(service) {
        const cb = circuitBreaker[service];
        if (!cb) return;

        cb.failures++;
        cb.lastFailure = Date.now();

        if (cb.failures >= config.circuitBreakerThreshold) {
            cb.isOpen = true;
            console.warn(`Circuit breaker OPEN for ${service}`);
        }
    }

    function recordSuccess(service) {
        const cb = circuitBreaker[service];
        if (!cb) return;
        cb.failures = 0;
        cb.isOpen = false;
    }

    // ============================================
    // CONNECTION STATUS
    // ============================================
    function updateConnectionStatus(status) {
        state.connectionStatus = status;
        const banner = document.getElementById('connection-banner');
        const indicator = document.getElementById('live-indicator');
        const liveText = document.getElementById('live-text');
        const bannerMsg = document.getElementById('banner-message');
        const retryBtn = document.getElementById('retry-btn');

        banner.className = 'connection-banner ' + status;
        indicator.className = 'live-dot ' + (status === 'offline' ? 'offline' : status === 'degraded' ? 'degraded' : '');

        if (status === 'offline') {
            liveText.textContent = 'Offline';
            bannerMsg.textContent = 'You are offline. Showing cached data.';
            retryBtn.style.display = 'none';
        } else if (status === 'degraded') {
            liveText.textContent = 'Degraded';
            bannerMsg.textContent = 'Some services are experiencing issues. Retrying...';
            retryBtn.style.display = 'block';
        } else {
            liveText.textContent = 'Live';
            retryBtn.style.display = 'none';
        }
    }

    // Online/offline detection
    window.addEventListener('online', () => {
        state.isOnline = true;
        updateConnectionStatus('online');
        retryAll();
    });

    window.addEventListener('offline', () => {
        state.isOnline = false;
        updateConnectionStatus('offline');
    });

    // ============================================
    // FETCH WITH RETRY & TIMEOUT
    // ============================================
    async function fetchWithRetry(url, options = {}, retries = config.maxRetries, service = 'default') {
        if (!state.isOnline) {
            throw new Error('Offline');
        }

        if (isCircuitOpen(service)) {
            throw new Error('Circuit breaker open');
        }

        const controller = new AbortController();
        const timeout = options.timeout || config.baseTimeout;
        const tid = setTimeout(() => controller.abort(), timeout);

        try {
            const res = await fetch(url, { 
                ...options, 
                signal: controller.signal 
            });
            clearTimeout(tid);

            if (!res.ok) {
                throw new Error(`HTTP ${res.status}`);
            }

            const data = await res.json();
            recordSuccess(service);
            return data;
        } catch (error) {
            clearTimeout(tid);
            recordFailure(service);

            if (retries > 0 && error.name !== 'AbortError' && state.isOnline) {
                await sleep(backoff(config.maxRetries - retries));
                return fetchWithRetry(url, options, retries - 1, service);
            }
            throw error;
        }
    }

    // ============================================
    // STARFIELD BACKGROUND
    // ============================================
    function createStarfield() {
        const container = document.getElementById('starfield');
        if (!container) return;

        const starCount = window.innerWidth < 640 ? 50 : 100;

        for (let i = 0; i < starCount; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.setProperty('--duration', (2 + Math.random() * 4) + 's');
            star.style.setProperty('--max-opacity', (0.3 + Math.random() * 0.7));
            star.style.animationDelay = Math.random() * 3 + 's';
            container.appendChild(star);
        }
    }

    // ============================================
    // MOBILE MENU
    // ============================================
    function openMobileMenu() {
        document.getElementById('mobile-menu').classList.add('open');
        document.body.style.overflow = 'hidden';
    }

    function closeMobileMenu() {
        document.getElementById('mobile-menu').classList.remove('open');
        document.body.style.overflow = '';
    }

    // ============================================
    // SPARKLINE DRAWING
    // ============================================
    function drawSparkline(canvasId, data, color) {
        const canvas = document.getElementById(canvasId);
        if (!canvas || data.length < 2) return;

        const ctx = canvas.getContext('2d');
        const rect = canvas.parentElement.getBoundingClientRect();
        const dpr = window.devicePixelRatio || 1;

        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        canvas.style.width = rect.width + 'px';
        canvas.style.height = rect.height + 'px';
        ctx.scale(dpr, dpr);

        const w = rect.width, h = rect.height, pad = 4;
        const min = Math.min(...data), max = Math.max(...data), range = max - min || 1;

        // Gradient fill
        const grad = ctx.createLinearGradient(0, 0, 0, h);
        grad.addColorStop(0, color + '40');
        grad.addColorStop(1, color + '00');

        ctx.beginPath();
        ctx.moveTo(pad, h);
        data.forEach((v, i) => {
            const x = pad + (i / (data.length - 1)) * (w - 2 * pad);
            const y = h - pad - ((v - min) / range) * (h - 2 * pad);
            ctx.lineTo(x, y);
        });
        ctx.lineTo(w - pad, h);
        ctx.closePath();
        ctx.fillStyle = grad;
        ctx.fill();

        // Line
        ctx.beginPath();
        data.forEach((v, i) => {
            const x = pad + (i / (data.length - 1)) * (w - 2 * pad);
            const y = h - pad - ((v - min) / range) * (h - 2 * pad);
            i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
        });
        ctx.strokeStyle = color;
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.stroke();

        // End dot
        const lastX = w - pad;
        const lastY = h - pad - ((data[data.length - 1] - min) / range) * (h - 2 * pad);
        ctx.beginPath();
        ctx.arc(lastX, lastY, 3, 0, Math.PI * 2);
        ctx.fillStyle = color;
        ctx.fill();
    }

    function showSparklineError(canvasId) {
        const container = document.getElementById(canvasId + '-wrap');
        if (container) {
            container.innerHTML = '<div class="sparkline-error">Chart unavailable</div>';
        }
    }

    // ============================================
    // CHART DRAWING
    // ============================================
    let chartInstance = null;

    function drawChart(data) {
        const canvas = document.getElementById('price-chart');
        const loading = document.getElementById('chart-loading');

        if (!canvas || !data || data.length < 2) {
            if (loading) loading.textContent = 'Unable to load chart data';
            return;
        }

        if (loading) loading.style.display = 'none';

        const ctx = canvas.getContext('2d');
        const rect = canvas.parentElement.getBoundingClientRect();
        const dpr = window.devicePixelRatio || 1;

        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        canvas.style.width = rect.width + 'px';
        canvas.style.height = rect.height + 'px';
        ctx.scale(dpr, dpr);

        const w = rect.width, h = rect.height;
        const pad = { top: 20, right: 60, bottom: 30, left: 10 };
        const chartW = w - pad.left - pad.right;
        const chartH = h - pad.top - pad.bottom;

        const prices = data.map(d => d.price);
        const min = Math.min(...prices);
        const max = Math.max(...prices);
        const range = max - min || 1;
        const priceRange = range * 1.1;
        const priceMin = min - priceRange * 0.05;

        // Clear
        ctx.clearRect(0, 0, w, h);

        // Grid lines
        ctx.strokeStyle = 'rgba(48, 54, 61, 0.5)';
        ctx.lineWidth = 1;
        for (let i = 0; i <= 4; i++) {
            const y = pad.top + (chartH / 4) * i;
            ctx.beginPath();
            ctx.moveTo(pad.left, y);
            ctx.lineTo(w - pad.right, y);
            ctx.stroke();

            // Price labels
            const price = max - (range / 4) * i;
            ctx.fillStyle = '#8b949e';
            ctx.font = '11px JetBrains Mono';
            ctx.textAlign = 'left';
            ctx.fillText(formatPrice(price), w - pad.right + 5, y + 4);
        }

        // Gradient fill
        const grad = ctx.createLinearGradient(0, pad.top, 0, h - pad.bottom);
        const isUp = prices[prices.length - 1] >= prices[0];
        const color = isUp ? '#3fb950' : '#f85149';
        grad.addColorStop(0, color + '30');
        grad.addColorStop(1, color + '00');

        // Draw area
        ctx.beginPath();
        ctx.moveTo(pad.left, h - pad.bottom);
        data.forEach((d, i) => {
            const x = pad.left + (i / (data.length - 1)) * chartW;
            const y = pad.top + chartH - ((d.price - priceMin) / priceRange) * chartH;
            ctx.lineTo(x, y);
        });
        ctx.lineTo(pad.left + chartW, h - pad.bottom);
        ctx.closePath();
        ctx.fillStyle = grad;
        ctx.fill();

        // Draw line
        ctx.beginPath();
        data.forEach((d, i) => {
            const x = pad.left + (i / (data.length - 1)) * chartW;
            const y = pad.top + chartH - ((d.price - priceMin) / priceRange) * chartH;
            i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
        });
        ctx.strokeStyle = color;
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.stroke();

        // Current price indicator
        const lastPoint = data[data.length - 1];
        const lastX = pad.left + chartW;
        const lastY = pad.top + chartH - ((lastPoint.price - priceMin) / priceRange) * chartH;

        ctx.beginPath();
        ctx.arc(lastX, lastY, 5, 0, Math.PI * 2);
        ctx.fillStyle = color;
        ctx.fill();
        ctx.beginPath();
        ctx.arc(lastX, lastY, 8, 0, Math.PI * 2);
        ctx.strokeStyle = color + '50';
        ctx.lineWidth = 2;
        ctx.stroke();
    }

    // ============================================
    // DATA FETCHING
    // ============================================
    async function fetchPrices() {
        try {
            const data = await fetchWithRetry(
                'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=usd&include_24hr_change=true',
                {},
                config.maxRetries,
                'prices'
            );

            state.btcPrice = data.bitcoin.usd;
            state.ethPrice = data.ethereum.usd;
            state.btcChange = data.bitcoin.usd_24h_change || 0;
            state.ethChange = data.ethereum.usd_24h_change || 0;

            // Update UI
            const btcPriceEl = document.getElementById('btc-price');
            const ethPriceEl = document.getElementById('eth-price');
            const btcChangeEl = document.getElementById('btc-change');
            const ethChangeEl = document.getElementById('eth-change');

            btcPriceEl.textContent = formatPrice(state.btcPrice);
            btcPriceEl.classList.remove('skeleton');
            ethPriceEl.textContent = formatPrice(state.ethPrice);
            ethPriceEl.classList.remove('skeleton');

            btcChangeEl.textContent = formatChange(state.btcChange);
            btcChangeEl.className = 'change-badge ' + (state.btcChange >= 0 ? 'change-positive' : 'change-negative');
            ethChangeEl.textContent = formatChange(state.ethChange);
            ethChangeEl.className = 'change-badge ' + (state.ethChange >= 0 ? 'change-positive' : 'change-negative');

            updateConnectionStatus('online');
        } catch (error) {
            console.error('Price fetch error:', error);
            updateConnectionStatus('degraded');
        }
    }

    async function fetchSparklines() {
        try {
            const [btc, eth] = await Promise.all([
                fetchWithRetry(
                    'https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=7&interval=hourly',
                    { timeout: 15000 },
                    2,
                    'sparkline'
                ),
                fetchWithRetry(
                    'https://api.coingecko.com/api/v3/coins/ethereum/market_chart?vs_currency=usd&days=7&interval=hourly',
                    { timeout: 15000 },
                    2,
                    'sparkline'
                )
            ]);

            state.btcHistory = btc.prices.map(p => p[1]);
            state.ethHistory = eth.prices.map(p => p[1]);

            const sample = (arr, n) => arr.filter((_, i) => i % Math.ceil(arr.length / n) === 0);
            const btcSample = sample(state.btcHistory, 50);
            const ethSample = sample(state.ethHistory, 50);

            drawSparkline('btc-sparkline', btcSample, btcSample[btcSample.length-1] >= btcSample[0] ? '#3fb950' : '#f85149');
            drawSparkline('eth-sparkline', ethSample, ethSample[ethSample.length-1] >= ethSample[0] ? '#3fb950' : '#f85149');
        } catch (error) {
            console.error('Sparkline error:', error);
            showSparklineError('btc-sparkline');
            showSparklineError('eth-sparkline');
        }
    }

    async function fetchChartData(days = 1) {
        try {
            const data = await fetchWithRetry(
                `https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=${days}`,
                { timeout: 15000 },
                2,
                'chart'
            );

            state.chartData = data.prices.map(p => ({
                time: p[0],
                price: p[1]
            }));

            drawChart(state.chartData);
        } catch (error) {
            console.error('Chart error:', error);
            document.getElementById('chart-loading').textContent = 'Unable to load chart';
        }
    }

    async function fetchNews() {
        try {
            const data = await fetchWithRetry(
                'https://cryptopanic.com/api/v1/posts/?auth_token=public&currencies=BTC,ETH&kind=news',
                { timeout: 10000 },
                2,
                'news'
            );

            const container = document.getElementById('news-container');
            container.innerHTML = '';

            (data.results || []).slice(0, 6).forEach(item => {
                const card = document.createElement('a');
                card.className = 'news-card';
                card.href = item.url;
                card.target = '_blank';
                card.rel = 'noopener noreferrer';
                card.innerHTML = '<h4>' + item.title + '</h4><div class="news-meta">' + 
                    (item.source?.title || 'Crypto') + ' • ' + 
                    new Date(item.created_at).toLocaleDateString() + '</div>';
                container.appendChild(card);
            });
        } catch (error) {
            console.error('News error:', error);
            showFallbackNews();
        }
    }

    function showFallbackNews() {
        document.getElementById('news-container').innerHTML = 
            '<a href="https://coindesk.com" target="_blank" rel="noopener" class="news-card"><h4>CoinDesk</h4><div class="news-meta">Latest Bitcoin News</div></a>' +
            '<a href="https://theblock.co" target="_blank" rel="noopener" class="news-card"><h4>The Block</h4><div class="news-meta">Crypto Research</div></a>' +
            '<a href="https://decrypt.co" target="_blank" rel="noopener" class="news-card"><h4>Decrypt</h4><div class="news-meta">Web3 News</div></a>';
    }

    function fetchNewsWithRetry() {
        document.getElementById('news-container').innerHTML = 
            '<div class="news-card"><div class="skeleton" style="height:14px;width:80%;margin-bottom:8px"></div><div class="skeleton" style="height:12px;width:50%"></div></div>'.repeat(3);
        circuitBreaker.news.failures = 0;
        circuitBreaker.news.isOpen = false;
        fetchNews();
    }

    function retryAll() {
        Object.keys(circuitBreaker).forEach(key => {
            circuitBreaker[key].failures = 0;
            circuitBreaker[key].isOpen = false;
        });
        fetchPrices();
        fetchNews();
        fetchSparklines();
        fetchChartData();
    }

    // ============================================
    // CHAT FUNCTIONALITY
    // ============================================
    const chatForm = document.getElementById('chat-form');
    const chatInput = document.getElementById('chat-input');
    const chatMessages = document.getElementById('chat-messages');
    const chatBtn = document.getElementById('chat-btn');

    function addMessage(content, isUser = false, isLoading = false) {
        const div = document.createElement('div');
        div.className = 'message chat-message ' + (isUser ? 'user' : 'ai');

        if (isLoading) {
            div.innerHTML = '<div class="message-avatar"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg></div><div class="message-bubble"><div class="typing-indicator"><span></span><span></span><span></span></div></div>';
        } else if (isUser) {
            div.innerHTML = '<div class="message-bubble">' + content + '</div>';
        } else {
            div.innerHTML = '<div class="message-avatar"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg></div><div class="message-bubble">' + content + '</div>';
        }

        chatMessages.appendChild(div);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        return div;
    }

    async function getAIResponse(msg) {
        chatInput.disabled = true;
        chatBtn.disabled = true;
        const loading = addMessage('', false, true);

        const systemPrompt = 'You are a crypto analyst. Current: BTC $' + state.btcPrice.toLocaleString() + 
            ' (' + (state.btcChange >= 0 ? '+' : '') + state.btcChange.toFixed(2) + '%), ETH $' + 
            state.ethPrice.toLocaleString() + ' (' + (state.ethChange >= 0 ? '+' : '') + 
            state.ethChange.toFixed(2) + '%). Give concise helpful answers under 100 words. Never give specific investment advice.';

        try {
            const controller = new AbortController();
            const tid = setTimeout(() => controller.abort(), 15000);

            const res = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json', 
                    'Authorization': 'Bearer YOUR_OPENAI_KEY' 
                },
                body: JSON.stringify({ 
                    model: 'gpt-4o-mini', 
                    messages: [
                        { role: 'system', content: systemPrompt }, 
                        { role: 'user', content: msg }
                    ], 
                    max_tokens: 200, 
                    temperature: 0.7 
                }),
                signal: controller.signal
            });
            clearTimeout(tid);

            const data = await res.json();
            loading.remove();

            if (data.choices?.[0]) {
                addMessage(data.choices[0].message.content);
            } else {
                addMessage('AI service requires API key configuration. Current: BTC $' + 
                    state.btcPrice.toLocaleString() + ', ETH $' + state.ethPrice.toLocaleString());
            }
        } catch (e) {
            loading.remove();
            addMessage('Based on current data: BTC $' + state.btcPrice.toLocaleString() + 
                ' (' + (state.btcChange >= 0 ? '+' : '') + state.btcChange.toFixed(2) + '%), ETH $' + 
                state.ethPrice.toLocaleString() + ' (' + (state.ethChange >= 0 ? '+' : '') + 
                state.ethChange.toFixed(2) + '%). Note: Full AI responses require OpenAI API key.');
        } finally {
            chatInput.disabled = false;
            chatBtn.disabled = false;
            chatInput.focus();
        }
    }

    chatForm.addEventListener('submit', e => {
        e.preventDefault();
        const msg = chatInput.value.trim();
        if (!msg) return;
        addMessage(msg, true);
        chatInput.value = '';
        getAIResponse(msg);
    });

    // ============================================
    // TIMEFRAME BUTTONS
    // ============================================
    document.querySelectorAll('.timeframe-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.timeframe-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const range = btn.dataset.range;
            const days = range === '1H' ? 1/24 : range === '4H' ? 1/6 : range === '1W' ? 7 : 1;
            fetchChartData(days);
        });
    });

    // ============================================
    // RESIZE HANDLER
    // ============================================
    let resizeTimeout;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
            if (state.btcHistory.length) {
                const sample = (arr, n) => arr.filter((_, i) => i % Math.ceil(arr.length / n) === 0);
                const btcSample = sample(state.btcHistory, 50);
                const ethSample = sample(state.ethHistory, 50);
                drawSparkline('btc-sparkline', btcSample, btcSample[btcSample.length-1] >= btcSample[0] ? '#3fb950' : '#f85149');
                drawSparkline('eth-sparkline', ethSample, ethSample[ethSample.length-1] >= ethSample[0] ? '#3fb950' : '#f85149');
            }
            if (state.chartData.length) {
                drawChart(state.chartData);
            }
        }, 250);
    });

    // ============================================
    // INITIALIZATION
    // ============================================
    function init() {
        createStarfield();
        fetchPrices();
        fetchSparklines();
        fetchChartData();
        fetchNews();

        // Set up intervals
        setInterval(fetchPrices, config.priceRefreshInterval);
        setInterval(fetchSparklines, 300000);
        setInterval(fetchChartData, config.chartRefreshInterval);
        setInterval(fetchNews, config.newsRefreshInterval);
    }

    init();
    </script>
</body>
</html>